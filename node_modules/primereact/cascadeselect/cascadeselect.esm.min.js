import*as e from"react";import n,{PrimeReactContext as t,localeOption as r}from"primereact/api";import{ComponentBase as o,useHandleStyle as a}from"primereact/componentbase";import{CSSTransition as l}from"primereact/csstransition";import{useMergeProps as i,useMountEffect as c,useUpdateEffect as s,useOverlayListener as u,useDisplayOrder as p,useGlobalOnEscapeKey as d,ESC_KEY_HANDLING_PRIORITIES as f,useUnmountEffect as m}from"primereact/hooks";import{ChevronDownIcon as v}from"primereact/icons/chevrondown";import{SpinnerIcon as b}from"primereact/icons/spinner";import{TimesIcon as y}from"primereact/icons/times";import{OverlayService as h}from"primereact/overlayservice";import{Portal as g}from"primereact/portal";import{classNames as w,DomHandler as S,ObjectUtils as O,IconUtils as E,UniqueComponentId as x,ZIndexUtils as I}from"primereact/utils";import{AngleRightIcon as P}from"primereact/icons/angleright";import{Ripple as C}from"primereact/ripple";function j(){return j=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},j.apply(null,arguments)}function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function D(e,n){if("object"!=G(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}function N(e){var n=D(e,"string");return"symbol"==G(n)?n:n+""}function k(e,n,t){return(n=N(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function A(e){if(Array.isArray(e))return e}function L(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,o,a,l,i=[],c=!0,s=!1;try{if(a=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=a.call(t)).done)&&(i.push(r.value),i.length!==n);c=!0);}catch(e){s=!0,o=e}finally{try{if(!c&&null!=t.return&&(l=t.return(),Object(l)!==l))return}finally{if(s)throw o}}return i}}function R(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function T(e,n){if(e){if("string"==typeof e)return R(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?R(e,n):void 0}}function H(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function B(e,n){return A(e)||L(e,n)||T(e,n)||H()}var V=o.extend({defaultProps:{__TYPE:"CascadeSelect",appendTo:null,ariaLabelledBy:null,autoFocus:!1,breakpoint:void 0,showClear:!1,className:null,dataKey:null,disabled:!1,loadingIcon:null,dropdownIcon:null,loading:!1,id:null,inputId:null,inputRef:null,invalid:!1,variant:null,itemTemplate:null,name:null,onBeforeHide:null,onBeforeShow:null,onChange:null,onGroupChange:null,onHide:null,onShow:null,optionGroupChildren:null,optionGroupIcon:null,optionGroupLabel:null,optionLabel:null,optionValue:null,options:null,panelClassName:null,panelStyle:null,placeholder:null,scrollHeight:"400px",style:null,tabIndex:null,transitionOptions:null,value:null,children:void 0},css:{classes:{root:function(e){var n=e.props,t=e.focusedState,r=e.context;return w("p-cascadeselect p-component p-inputwrapper",{"p-disabled":n.disabled,"p-invalid":n.invalid,"p-variant-filled":n.variant?"filled"===n.variant:r&&"filled"===r.inputStyle,"p-focus":t,"p-inputwrapper-filled":n.value,"p-inputwrapper-focus":t||e.overlayVisibleState})},label:function(e){var n=e.props,t=e.label;return w("p-cascadeselect-label ",{"p-placeholder":t===n.placeholder,"p-cascadeselect-label-empty":!n.value&&"p-emptylabel"===t})},list:"p-cascadeselect-panel p-cascadeselect-items",sublistWrapper:"p-cascadeselect-sublist-wrapper",sublist:"p-cascadeselect-panel p-cascadeselect-items p-cascadeselect-sublist",item:function(e){return w("p-cascadeselect-item",{"p-cascadeselect-item-group":e.isGroup,"p-cascadeselect-item-active p-highlight":e.isSelected})},dropdownIcon:"p-cascadeselect-trigger-icon",clearIcon:"p-cascadeselect-clear-icon p-clickable",loadingIcon:"p-cascadeselect-trigger-icon",dropdownButton:"p-cascadeselect-trigger",loadingButton:"p-cascadeselect-trigger",wrapper:"p-cascadeselect-items-wrapper",panel:"p-cascadeselect-panel p-component",content:"p-cascadeselect-item-content",optionGroupIcon:"p-cascadeselect-group-icon",text:"p-cascadeselect-item-text",transition:"p-connected-overlay"},styles:"\n@layer primereact {\n    .p-cascadeselect {\n        display: inline-flex;\n        cursor: pointer;\n        position: relative;\n        user-select: none;\n    }\n\n    .p-cascadeselect-trigger {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-shrink: 0;\n    }\n\n    .p-cascadeselect-label {\n        display: block;\n        white-space: nowrap;\n        overflow: hidden;\n        flex: 1 1 auto;\n        width: 1%;\n        text-overflow: ellipsis;\n        cursor: pointer;\n    }\n\n    .p-cascadeselect-label-empty {\n        overflow: hidden;\n        visibility: hidden;\n    }\n\n    .p-cascadeselect .p-cascadeselect-panel {\n        min-width: 100%;\n    }\n\n    .p-cascadeselect-item {\n        cursor: pointer;\n        font-weight: normal;\n        white-space: nowrap;\n    }\n\n    .p-cascadeselect-item-content {\n        display: flex;\n        align-items: center;\n        overflow: hidden;\n        position: relative;\n    }\n\n    .p-cascadeselect-group-icon {\n        margin-left: auto;\n    }\n\n    .p-cascadeselect-items {\n        margin: 0;\n        padding: 0;\n        list-style-type: none;\n        min-width: 100%;\n    }\n\n    .p-fluid .p-cascadeselect {\n        display: flex;\n    }\n\n    .p-fluid .p-cascadeselect .p-cascadeselect-label {\n        width: 1%;\n    }\n\n    .p-cascadeselect-sublist-wrapper {\n        position: absolute;\n        min-width: 100%;\n        z-index: 1;\n        display: none;\n    }\n\n    .p-cascadeselect-item-active {\n        overflow: visible;\n    }\n\n    .p-cascadeselect-item-active > .p-cascadeselect-sublist-wrapper {\n        display: block;\n        left: 100%;\n        top: 0;\n    }\n    .p-cascadeselect-clear-icon {\n        position: absolute;\n        top: 50%;\n        margin-top: -.5rem;\n        right: 3rem;\n    }\n}\n"}});function F(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function K(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?F(Object(t),!0).forEach((function(n){k(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):F(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var _=e.memo((function(n){var r=i(),o=B(e.useState(null),2),a=o[0],l=o[1],u=e.useRef(null),p=e.useContext(t),d=n.ptm,f=n.cx,m=function(e,t){return d(e,{hostName:n.hostName,state:K({},t)})},v=function(e){n.onOptionSelect&&n.onOptionSelect(e)},b=function(e,t){var r=e.currentTarget.parentElement;switch(e.key){case"Down":case"ArrowDown":var o=y(r);o&&o.children[0].focus();break;case"Up":case"ArrowUp":var i=h(r);i&&i.children[0].focus();break;case"Right":case"ArrowRight":D(t)&&(a===t?r.children[1].children[0].children[0].focus():l(t));break;case"Left":case"ArrowLeft":l(null);var c=e.currentTarget.parentElement.parentElement.previousElementSibling;c&&c.focus();break;case"Enter":g(e,t);break;case"Tab":case"Escape":n.onPanelHide&&(n.onPanelHide(),e.preventDefault())}e.preventDefault()},y=function(e){var n=e.nextElementSibling;return n?S.hasClass(n,"p-disabled")||!S.hasClass(n,"p-cascadeselect-item")?y(n):n:null},h=function(e){var n=e.previousElementSibling;return n?S.hasClass(n,"p-disabled")||!S.hasClass(n,"p-cascadeselect-item")?h(n):n:null},g=function(e,t){D(t)?(l((function(e){return e===t?null:t})),n.onOptionGroupSelect&&n.onOptionGroupSelect({originalEvent:e,value:t})):n.onOptionSelect&&n.onOptionSelect({originalEvent:e,value:G(t)})},x=function(e){n.onOptionGroupSelect&&n.onOptionGroupSelect(e)},I=function(e){return n.optionLabel?O.resolveFieldData(e,n.optionLabel):e},G=function(e){return n.optionValue?O.resolveFieldData(e,n.optionValue):e},D=function(e){return Object.prototype.hasOwnProperty.call(e,n.optionGroupChildren[n.level])},N=function(e){return D(e)?(t=e,n.optionGroupLabel?O.resolveFieldData(t,n.optionGroupLabel):null):I(e);var t};c((function(){if(n.selectionPath&&n.options&&!n.dirty){var e=n.options.find((function(e){return n.selectionPath.includes(e)}));e&&l(e)}var t,r,o,a,i;n.root||(r=S.getOffset(t=u.current.parentElement.parentElement),o=S.getViewport(),a=u.current.offsetParent?u.current.offsetWidth:S.getHiddenElementOuterWidth(V),i=S.getOuterWidth(t.children[0]),parseInt(r.left,10)+i+a>o.width-S.calculateScrollbarWidth()&&(u.current.parentElement.style.left="-100%"))})),s((function(){n.parentActive||l(null)}),[n.parentActive]);var k,A,L,R,T=function(t){if(D(t)&&a===t){var r=O.resolveFieldData(t,n.optionGroupChildren[n.level]),o=a===t,l=n.level+1;return e.createElement(_,{hostName:n.hostName,options:r,className:f("sublist"),selectionPath:n.selectionPath,optionLabel:n.optionLabel,optionValue:n.optionValue,level:l,onOptionSelect:v,onOptionGroupSelect:x,parentActive:o,optionGroupLabel:n.optionGroupLabel,optionGroupChildren:n.optionGroupChildren,dirty:n.dirty,template:n.template,onPanelHide:n.onPanelHide,ptm:d,cx:f})}return null},H=function(t,o){var l=T(t),i=r({className:f("text")},m("text")),c=n.template?O.getJSXElement(n.template,G(t)):e.createElement("span",i,N(t)),s=r({className:f("optionGroupIcon")},m("optionGroupIcon")),u=n.optionGroupIcon||e.createElement(P,s),p=D(t)&&E.getJSXIcon(u,K({},s),{props:n}),d=N(t)+"_"+o,v=r({className:f("content"),onClick:function(e){return g(e,t)},tabIndex:0,onKeyDown:function(e){return b(e,t)}},m("content")),y=a===t,h=D(t),S=r({className:w(t.className,f("item",{option:t,isGroup:h,isSelected:y})),style:t.style,role:"none","data-p-item-group":h,"data-p-highlight":y},m("item",{selected:y,group:h}));return e.createElement("li",j({key:d},S),e.createElement("div",v,c,p,e.createElement(C,null)),l)},V=(k=r({ref:u,className:f(0===n.level?"list":"sublist",{context:p}),role:"listbox","aria-orientation":"horizontal"},m(0===n.level?"list":"sublist")),A=n.options?n.options.map(H):null,L=e.createElement("ul",k,A),R=r({className:f("sublistWrapper")},m("sublistWrapper")),0===n.level?L:e.createElement("div",R,L));return V}));function W(e,n){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=U(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,i=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){i=!0,a=e},f:function(){try{l||null==t.return||t.return()}finally{if(i)throw a}}}}function U(e,n){if(e){if("string"==typeof e)return J(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?J(e,n):void 0}}function J(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function M(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function X(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?M(Object(t),!0).forEach((function(n){k(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):M(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var z=e.memo(e.forwardRef((function(o,P){var C=i(),G=e.useContext(t),D=V.getProps(o,G),N=B(e.useState(!1),2),k=N[0],A=N[1],L=B(e.useState(!1),2),R=L[0],T=L[1],H=B(e.useState(null),2),F=H[0],K=H[1],U=V.setMetaData({props:D,state:{focused:k,overlayVisible:R,attributeSelector:F},context:X({},G)}),J=U.ptm,M=U.cx;a(V.css.styles,U.isUnstyled,{name:"cascadeselect"});var z=e.useRef(null),Z=e.useRef(null),$=e.useRef(null),q=e.useRef(null),Y=e.useRef(null),Q=e.useRef(!1),ee=e.useRef(null),ne=e.useRef(null),te=B(u({target:z,overlay:Z,listener:function(e,n){n.valid&&(G.hideOverlaysOnDocumentScrolling||"outside"===n.type?he():S.isDocument(e.target)||Ee())},when:R}),2),re=te[0],oe=te[1],ae=p("cascade-select",R);d({callback:function(){he()},when:R&&ae,priority:[f.CASCADE_SELECT,ae]});var le=function(e){D.onChange&&(ne.current=!0,D.onChange({originalEvent:e,value:e.value})),de(),he(),S.focus($.current)},ie=function(e){Q.current=!0,D.onGroupChange&&D.onGroupChange(e)},ce=function(e){return(D.optionLabel?O.resolveFieldData(e,D.optionLabel):e)||e},se=function(e){return D.optionValue?O.resolveFieldData(e,D.optionValue):e},ue=function(e,n){return O.resolveFieldData(e,D.optionGroupChildren[n])},pe=function(e,n){return Object.prototype.hasOwnProperty.call(e,D.optionGroupChildren[n])},de=function(){var e;if(null!=D.value&&D.options){var n,t=W(D.options);try{for(t.s();!(n=t.n()).done;){if(e=fe(n.value,0))break}}catch(e){t.e(e)}finally{t.f()}}ee.current=e},fe=function(e,n){if(pe(e,n)){var t,r,o=W(ue(e,n));try{for(o.s();!(r=o.n()).done;){if(t=fe(r.value,n+1))return t.unshift(e),t}}catch(e){o.e(e)}finally{o.f()}}else if(O.equals(D.value,se(e),D.dataKey))return[e];return null},me=function(){A(!0)},ve=function(){A(!1)},be=function(e){switch(e.which){case 40:R?S.findSingle(Z.current,'[data-pc-section="item"]').children[0].focus():e.altKey&&D.options&&D.options.length&&ye(),e.preventDefault();break;case 32:R?he():ye(),e.preventDefault();break;case 9:he()}},ye=function(){D.onBeforeShow&&D.onBeforeShow(),T(!0)},he=function(){D.onBeforeHide&&D.onBeforeHide(),T(!1),S.focus($.current)},ge=function(){I.set("overlay",Z.current,G&&G.autoZIndex||n.autoZIndex,G&&G.zIndex.overlay||n.zIndex.overlay),S.addStyles(Z.current,{position:"absolute",top:"0",left:"0"}),Ee(),F&&D.breakpoint&&(Z.current.setAttribute(F+"_panel",""),xe())},we=function(){re(),D.onShow&&D.onShow()},Se=function(){oe(),Q.current=!1},Oe=function(){I.clear(Z.current),D.onHide&&D.onHide(),Ie()},Ee=function(){S.alignOverlay(Z.current,q.current.parentElement,D.appendTo||G&&G.appendTo||n.appendTo)},xe=function(){if(!Y.current){Y.current=S.createInlineStyle(G&&G.nonce||n.nonce,G&&G.styleContainer);var e="".concat(F,"_panel"),t="\n@media screen and (max-width: ".concat(D.breakpoint,") {\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-items-wrapper > ul {\n        max-height: ").concat(D.scrollHeight,";\n        overflow: ").concat(D.scrollHeight?"auto":"",";\n    }\n\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-sublist-wrapper {\n        position:relative;\n        left:0 !important;\n    }\n\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-sublist {\n        overflow: hidden !important;\n    }\n\n    .p-cascadeselect-panel[").concat(e,"] .p-cascadeselect-item-active  .p-cascadeselect-sublist {\n        left: 0;\n        box-shadow: none;\n        border-radius: 0;\n        padding: 0 0 0 calc(var(--inline-spacing) * 2); /* @todo */\n    }\n\n    .p-cascadeselect-panel[").concat(e,'] .p-cascadeselect-group-icon:before {\n        content: "\\e930";\n    }\n}\n');Y.current.innerHTML=t}},Ie=function(){Y.current=S.removeInlineStyle(Y.current)};e.useImperativeHandle(P,(function(){return{props:D,getElement:function(){return z.current},getOverlay:function(){return Z.current},getInput:function(){return $.current},getLabel:function(){return q.current},focus:function(){return S.focus($.current)}}})),c((function(){D.breakpoint&&!F&&K(x()),D.autoFocus&&S.focus($.current,D.autoFocus),Ee()})),e.useEffect((function(){O.combinedRefs($,D.inputRef)}),[$,D.inputRef]),s((function(){de()}),[D.value]),m((function(){I.clear(Z.current)}));var Pe=function(e){D.onChange&&(ne.current=!0,D.onChange({originalEvent:e,value:void 0,stopPropagation:function(){null==e||e.stopPropagation()},preventDefault:function(){null==e||e.preventDefault()},target:{name:D.name,id:D.id,value:void 0}}))},Ce=function(e){"Enter"!==e.key&&"Space"!==e.code||(Pe(e),e.preventDefault())},je=function(){if(null!=D.value&&D.showClear&&!D.disabled){var n=C({className:M("clearIcon"),onPointerUp:Pe,tabIndex:D.tabIndex||"0",onKeyDown:Ce,"aria-label":r("clear")},J("clearIcon"));return E.getJSXIcon(D.clearIcon||e.createElement(y,n),X({},n),{props:D})}return null},Ge=function(){var n=C({className:M("dropdownIcon")},J("dropdownIcon")),t=E.getJSXIcon(D.dropdownIcon||e.createElement(v,n),X({},n),{props:D}),r=C({className:M("dropdownButton"),role:"button","aria-haspopup":"listbox","aria-expanded":R},J("dropdownButton"));return e.createElement("div",r,t)},De=C({className:M("wrapper")},J("wrapper")),Ne=C({ref:Z,className:w(D.panelClassName,M("panel")),style:D.panelStyle,onClick:function(e){h.emit("overlay-click",{originalEvent:e,target:z.current})}},J("panel")),ke=function(){var n=C({classNames:M("transition"),in:R,timeout:{enter:120,exit:100},options:D.transitionOptions,unmountOnExit:!0,onEnter:ge,onEntered:we,onExit:Se,onExited:Oe},J("transition")),t=e.createElement(l,j({nodeRef:Z},n),e.createElement("div",Ne,e.createElement("div",De,e.createElement(_,{hostName:"CascadeSelect",options:D.options,selectionPath:ee.current,optionGroupIcon:D.optionGroupIcon,optionLabel:D.optionLabel,optionValue:D.optionValue,parentActive:null!=D.value,level:0,optionGroupLabel:D.optionGroupLabel,optionGroupChildren:D.optionGroupChildren,onOptionSelect:le,onOptionGroupSelect:ie,root:!0,template:D.itemTemplate,onPanelHide:he,ptm:J,cx:M}))));return e.createElement(g,{element:t,appendTo:D.appendTo})},Ae=V.getOtherProps(D);O.reduceKeys(Ae,S.DATA_PROPS);var Le,Re,Te,He,Be,Ve,Fe,Ke,_e,We,Ue,Je,Me,Xe,ze=O.reduceKeys(Ae,S.ARIA_PROPS);return Le=D.value?ce(D.value):void 0,Re=C({className:"p-hidden-accessible"},J("hiddenSelectedMessage")),Te=C(X({ref:$,type:"text",id:D.inputId,name:D.name,defaultValue:Le,readOnly:!0,disabled:D.disabled,onFocus:me,onBlur:ve,onKeyDown:function(e){return be(e)},tabIndex:D.tabIndex,"aria-haspopup":"listbox"},ze),J("input")),_e=e.createElement("div",Re,e.createElement("input",Te)),He=D.value?ce(D.value):D.placeholder||"p-emptylabel",Be=C({ref:q,className:M("label",{label:He})},J("label",{context:X({label:He},G)})),We=e.createElement("span",Be,He),Ue=je(),Je=D.loading?(Ve=C({className:M("loadingIcon")},J("loadingIcon")),Fe=E.getJSXIcon(D.loadingIcon||e.createElement(b,{spin:!0}),X({},Ve),{props:D}),Ke=C({className:M("loadingButton"),role:"button","aria-haspopup":"listbox","aria-expanded":R},J("dropdownButton")),e.createElement("div",Ke,Fe)):Ge(),Me=ke(),Xe=C({id:D.id,ref:z,className:w(D.className,M("root",{focusedState:k,overlayVisibleState:R,context:G})),style:D.style,onClick:function(e){return n=e,void(D.disabled||D.loading||Z.current&&Z.current.contains(n.target)||(S.focus($.current),R?he():ye()));var n}},Ae,J("root")),e.createElement("div",Xe,_e,We,Ue,Je,Me)})));z.displayName="CascadeSelect";export{z as CascadeSelect};
